<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <style>
    @import "index.css";
    
    body {
      font-family: sans-serif;
    }
    
    a[nohref], a[nofollow] {
      color: blue;
      cursor: pointer;
    }
  </style>
</head>
<body>
  
  <div id="picker-1"></div>
  <div id="picker-2"></div>

  <p>
    <button id="use-selected-1-btn">Use Selected of 1</button>
    <!-- <button id="use-selected-2-btn">Use Selected of 2</button> -->
    <button id="set-listmode-btn">Set List mode</button>
    <button id="set-iconsmode-btn">Set Icons mode</button>
  </p>
  
  <p id="selected-output-1"></p>
  <!-- <p id="selected-output-2"></p> -->

  <script src="index.js"></script>
  <script>
    function getJson(url, callback) {
      var request = new XMLHttpRequest();
      request.open('GET', url, true);
      request.onload = function() {
        if (request.status >= 200 && request.status < 400) {
          // Success
          if (typeof callback === 'function') {
            callback(null, JSON.parse(request.responseText));
          }
        } else if (request.status === 401) {
          // When service tell us that we are not loggen in.
          // So we are try log in.
          window.__resumeGetJson = function() {
            getJson(url, callback);
          };
          window.open('oauth.php');
        } else {
          // We reached our target server, but it returned an error
          if (typeof callback === 'function') {
            callback("We get error from service.");
          }
        }
      };
      request.onerror = function() {
        // There was a connection error of some sort
        if (typeof callback === 'function') {
          callback("We can't request service.");
        }
      };
      request.send();
    }

    // First picker instance
    var picker1 = new Picker({
      container: document.getElementById('picker-1'), // Optional.
      viewMode: 'icons'
      // viewMode: 'list'
    });
    // You need to define this hadler for async requests for get picker items.
    // When user click on folder - this handler is triggered.
    picker1.onNavigate(function(callback, path, item) {
      getJson('service.php?path=' + path, function(error, data) {
        if (error) {
          alert(error);
          return;
        }
        callback(data.result);
      });
    });
    // You can define this handler for retrive selected items.
    // This handler is triggered each time when user select item.
    picker1.onSelect(function(triggeredItem, selectedItems) {
      console && console.log('Triggered item: ', triggeredItem);
      console && console.log('Selected items: ', selectedItems);
    });
    // You need to call this function for trigger onNavigate handler.
    picker1.navigate();
    
    document.getElementById('use-selected-1-btn').onclick = function() {
      document.getElementById('selected-output-1').innerHTML = JSON.stringify(picker1.getSelected());
    };
    
    document.getElementById('set-listmode-btn').onclick = function() {
      picker1.setViewMode('list');
    };
    
    document.getElementById('set-iconsmode-btn').onclick = function() {
      picker1.setViewMode('icons');
    };
  </script>
</body>
</html>
